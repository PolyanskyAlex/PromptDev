# Работа с файловой системой

## Безопасная запись файлов

Для безопасной работы с файловой системой используется функция `writeFileSafely`:

```go
func writeFileSafely(filePath string, content []byte, force bool) error
```

### Возможности функции

1. Автоматическое создание всех необходимых родительских директорий
2. Проверка существования файла перед записью (если флаг `force` не установлен)
3. Безопасная запись данных с корректными правами доступа:
   - 0644 для файлов
   - 0755 для директорий

### Примеры использования

```go
// Запись нового файла
err := writeFileSafely("path/to/new/file.txt", []byte("content"), false)

// Перезапись существующего файла
err := writeFileSafely("path/to/existing/file.txt", []byte("new content"), true)
```

### Обработка ошибок

- Если файл существует и флаг `force` не установлен, возвращается ошибка
- При проблемах с созданием директорий возвращается ошибка с деталями
- При проблемах с записью файла возвращается ошибка с деталями

## Безопасность

### Path Traversal Protection

Для защиты от Path Traversal атак используются следующие механизмы:

1. Очистка пути с помощью `filepath.Clean`
2. Получение абсолютного пути через `filepath.Abs`
3. Проверка, что результирующий путь является дочерним по отношению к выходной директории

### Права доступа

- Все создаваемые файлы получают права доступа 0644 (чтение для всех, запись только для владельца)
- Все создаваемые директории получают права доступа 0755 (выполнение и чтение для всех, запись только для владельца)

## Структура директорий

После обработки входного JSON файла создается следующая структура:

```
./
├── docs/
│   ├── tech_docs/
│   │   ├── architecture/
│   │   ├── api/
│   │   └── deployment/
│   └── user_docs/
└── tasks/
    ├── dev/
    └── deploy/
```

## Обработка ошибок

### Типы ошибок

1. **Ошибки доступа**
   - Отсутствие прав на запись
   - Отсутствие прав на создание директорий

2. **Ошибки существования**
   - Попытка записи в существующий файл без флага force
   - Попытка создания директории, когда файл с таким именем уже существует

3. **Ошибки безопасности**
   - Попытка записи за пределы выходной директории
   - Некорректные пути или имена файлов

### Логирование

Все ошибки файловой системы логируются с помощью стандартного пакета `log` с указанием:
- Типа операции
- Пути файла
- Деталей ошибки 