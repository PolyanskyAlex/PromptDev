---
description: 
globs: 
alwaysApply: false
---
{
  "context": "hierarchical_development_pipeline",
  "description": "Интеллектуальный пайплайн, управляющий полным циклом разработки. Он различает родительские задачи (контейнеры) и подзадачи (единицы работы), обеспечивая их последовательное выполнение.",
  
  "entry_point": "Инициализация и декомпозиция",

  "pipeline": [
    {
      "name": "Инициализация и декомпозиция",
      "description": "Начальный шаг. Определяет, является ли текущая задача родительской, и запускает соответствующий воркфлоу.",
      "task": "Проанализировать номер задачи {task_id}. Если номер имеет формат X.Y (например, 1.1), это родительская задача. Если X.Y.Z (например, 1.1.1), это подзадача.",
      "next": {
        "conditions": [
          {
            "condition": "Задача является родительской",
            "next_step": "Оркестрация выполнения подзадач"
          }
        ],
        "default": "Анализ подзадачи"
      }
    },
    {
      "name": "Оркестрация выполнения подзадач",
      "description": "Управляет жизненным циклом родительской задачи. Выполняет ее подзадачи последовательно.",
      "task": [
        "Обновить статус родительской задачи {task_id} на 'В работе'.",
        "Найти все файлы подзадач для родительской задачи {task_id}, которые имеют статус 'Ожидание'.",
        "Собрать список всех выполненных задач (прочитав их статусы).",
        "Для каждой невыполненной подзадачи прочитать её поле 'dependencies'.",
        "Выбрать для выполнения ту подзадачу, у которой все зависимости из списка уже находятся в статусе 'Выполнена' (или у которой зависимостей нет).",
        "Если найдена готовая к выполнению подзадача, запустить для нее соответствующий воркфлоу (анализ, разработка и т.д.).",
        "Если готовых к выполнению подзадач нет, но остались незавершенные, ожидать их выполнения. (Это состояние цикла оркестрации).",
        "Если все подзадачи выполнены, перейти к шагу 'Завершение родительской задачи'."
       ]
    },
    {
      "name": "Анализ подзадачи",
      "description": "Детальный анализ конкретной подзадачи перед началом работы.",
      "task": "Проанализируй файл подзадачи: требования, логику, зависимости. Проверь документацию, SAD и существующий код. Запроси у `context7` через MCP релевантные технологии. Выдай краткий план действий.",
      "next": "Разработка"
    },
    {
      "name": "Разработка",
      "description": "Написание кода для выполнения подзадачи.",
      "task": "Выполни работы в соответствии с подзадачей, строго следуя правилам из `.cursor/rules/dev.mdc`.",
      "next": "Тестирование"
    },
    {
      "name": "Тестирование",
      "description": "Запуск автотестов для проверки реализованной функциональности.",
      "task": "Проведи тестирование в соответствии с правилами из `.cursor/rules/testing.mdc`.",
      "next": {
        "on_success": "Ревью кода",
        "on_failure": "Багфиксинг"
      }
    },
    {
      "name": "Багфиксинг",
      "description": "Цикл исправления ошибок, выявленных на этапе тестирования или ревью.",
      "task": "Найди коренную причину (root cause) ошибки и исправь ее, следуя правилам из `.cursor/rules/bugfixing.mdc`. Обязательно добавь тест, который воспроизводит и предотвращает этот баг в будущем.",
      "next": "Тестирование"
    },
    {
      "name": "Ревью кода",
      "description": "Проведение само-ревью выполненной работы по чек-листу.",
      "task": "Проведи ревью выполненного кода по подзадаче в соответствии с правилами из `.cursor/rules/review.mdc`.",
      "next": {
        "on_success": "Завершение подзадачи",
        "on_failure": "Багфиксинг"
      }
    },
    {
      "name": "Завершение подзадачи",
      "description": "Финализация работы по конкретной единице работы.",
      "task": [
        "Обнови статус подзадачи на 'Выполнена' в ее файле, если выполнена родительская задача - обнови ее статус в файле и в dev_plan.md или в deploy_plan.md.",
        "Сделай атомарный commit в git с детальным сообщением согласно правилам.",
        "Создай краткий отчет о проделанной работе и принятых решениях по этой подзадаче.",
        "Сделай комит в git",
        "Сигнализировать 'Оркестратору' о завершении, чтобы он мог запустить следующую подзадачу."
      ]
    },
    {
      "name": "Завершение родительской задачи",
      "description": "Финализация работы по родительской задаче.",
      "task": [
        "Обнови статус родительской задачи на 'Ожидание подтверждения'.",
        "Собери отчеты по всем подзадачам в один общий, структурированный отчет.",
        "Напиши или обнови общую документацию (`tech_docs.mdc`, `user_docs.mdc`) для всей реализованной функциональности.",
        "Обнови `README.md` с инструкциями по запуску и использованию новой фичи, если применимо.",
        "Сделай комит в git",
        "Представь финальный отчет пользователю и запроси формальное подтверждение."
      ]
    }
  ]
}